# 哈基米编码器 (Everything to Hajimi)

将你的图片（或者别的什么）转换成独特的“哈基米”文字编码，再完美还原！ 🐱

这个基于 Python 和 Gradio 的小工具可以将任意尺寸的图片智能处理、压缩，并编码成一段由“哈基米”及其相关字符组成的趣味文本。你也可以将这段文本粘贴回来，解码并预览原始图片。

## 🌟 特性

*   **趣味编码**: 使用自定义的“哈基米”字典将二进制数据转换为易于分享（虽然很长）的文字。
*   **智能图片处理 **(基于面积)
    *   **小图优先**: 对于分辨率（宽 x 高）乘积小于或等于 16,384 (例如 128x128) 的图片，**直接处理，不进行缩放或填充**，以最大程度保留细节并减少编码后的文本长度。
    *   **大图缩放**: 对于分辨率乘积大于 16,384 的图片，会按原始比例**智能缩放**，确保缩放后图片的面积小于 16,384，同样**不进行填充**。
*   **自适应压缩**: 根据图片的尺寸和复杂度（颜色变化）自动调整 WebP 压缩质量与颜色数量，在文件大小和图片质量间取得平衡。
*   **信息保留**: 编码文本开头会保留原始图片的尺寸信息 (`尺寸:宽x高|`)，方便了解原图大小。
*   **便捷解码**: 可以轻松地将生成的“加密文本”解码回图片进行预览。
*   **友好界面**: 基于 Gradio 构建的 Web 界面，操作简单直观。

## 🚀 快速开始

### 1. 安装依赖

确保你的 Python 环境中安装了所需的库。在终端或命令提示符中运行：

```bash
pip install gradio pillow numpy
```

或者使用requirements来安装依赖
*注意：`base91` 库可能需要单独安装或使用其标准实现。请确保你的环境中可以 `import base91`。*

### 2. 运行程序

将程序代码保存为 `app.py` (或任意 `.py` 文件名)，然后在终端中运行：

```bash
python app.py
```

### 3. 使用

1.  程序启动后，会在终端输出一个本地 URL (例如 `Running on local URL:  http://127.0.0.1:7860`)。
2.  在浏览器中打开该 URL 即可访问界面。
3.  **编码**:
    *   点击 "上传图片" 选择一张图片。
    *   （可选）拖动 "压缩质量" 滑块调整压缩强度。
    *   点击 "转换为文字" 按钮。
    *   图片将被处理、压缩并转换为 "加密文本"，显示在下方文本框中。
    *   点击 "复制文本" 可以将生成的加密文本复制到剪贴板。
4.  **解码**:
    *   将之前生成的 "加密文本" 粘贴到 "加密文本" 框中（或直接使用刚编码完的结果）。
    *   点击 "从文本还原图片" 按钮。
    *   程序会解析文本，并在 "解码预览" 区域显示还原出的图片。
    *   成功解码后，相关的处理信息（如原始尺寸、解码后尺寸）会显示在 "解码参数" 框中。
  
5.  **直接运行**
   *    使用releases中的.exe程序直接运行。

## 🧠 工作原理

1.  **图片处理**:
    *   计算上传图片的宽高乘积。
    *   如果乘积 > 16,384，则计算缩放比例 `sqrt(16384 / 原始面积)`，并将图片等比例缩小。
    *   如果乘积 <= 16,384，则保持图片原始尺寸不变。
2.  **压缩**:
    *   对处理后的图片进行 WebP 格式压缩，压缩参数会根据图片尺寸和复杂度自适应调整。
3.  **编码**:
    *   将压缩后的二进制 WebP 数据用 `zlib` 再次压缩。
    *   使用 `base91` 算法将二进制数据编码为 ASCII 字符串。
    *   使用预设的“哈基米”字典，将 base91 编码中的特定字符序列替换为对应的中文字符。
    *   在最终文本前加上 `尺寸:原始宽x原始高|` 前缀。
4.  **解码**:
    *   读取 "加密文本"。
    *   解析并移除 `尺寸:...|` 前缀。
    *   使用“哈基米”字典进行反向替换。
    *   使用 `base91` 解码。
    *   使用 `zlib` 解压。
    *   将解压后的数据作为 WebP 图像加载并显示。

## 📝 注意事项

*   生成的“加密文本”可能非常长，尤其是在处理细节丰富的图片时。  
*   压缩质量和图片复杂度会影响最终文本的长度和解码后图片的质量。
*   请确保输入的“加密文本”格式正确，否则解码会失败。

## ✅ 未来计划
*   [ ] 音频转码为哈基米，解决评论区不能发语音的问题
*   [ ] 优化文本长度问题
*   [ ] 优化字符编码
